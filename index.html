<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log In</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div class="container mx-auto px-4 py-4 h-screen flex justify-center items-center bg-cover bg-center bg-no-repeat aspect-video before:bg-black/50 before:w-full before:h-screen before:absolute" style="background-image: url('./asset/img/bg.jpg');">
        <div class="flex flex-col gap-y-4 w-full md:w-1/2 lg:w-1/3 mt-[15rem]">
            <!-- <h1 class="uppercase font-bold tracking-tighter text-[2rem] break-words leading-10 text-[#0059DB]">Log In Form</h1> -->
            <div class="bg-white/40 backdrop-blur-md rounded-lg p-4 border-2 border-gray-300/50">
                <form id="logInForm" action="#" method="POST" class="flex flex-col p-4 gap-y-4">
                    <div class="flex flex-col gap-y-2">
                        <label for="nim" class="block">
                            <span class="block text-sm font-medium text-slate-700">NIM</span>
                            <input type="number" id="nim" name="nim" required class="mt-1 px-3 py-2 bg-white border shadow-sm border-slate-300 placeholder-slate-400 focus:outline-none focus:border-[#0059DB] focus:ring-[#0059DB] block w-full rounded-md sm:text-sm focus:ring-1">
                        </label>
                    </div>
                    
                    <div class="flex flex-col gap-y-2">
                        <label for="password" class="block">
                            <span class="block text-sm font-medium text-slate-700">Password</span>
                            <input type="password" id="password" name="password" required class="mt-1 px-3 py-2 bg-white border shadow-sm border-slate-300 placeholder-slate-400 focus:outline-none focus:border-[#0059DB] focus:ring-[#0059DB] block w-full rounded-md sm:text-sm focus:ring-1">
                        </label>
                    </div>
                    
                    <input type="submit" value="Log In" class="p-2 bg-[#0059DB] rounded-lg font-medium uppercase text-sm text-white hover:bg-[#0059DB]">
                </form>
            
                <a href="./register.html" class="ml-4 font-medium text-sm underline">Register</a>
            </div>
        </div>
    </div>

    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="./js/failCounter.js"></script>
    <script src="./js/loginValidation.js"></script>
    <script>
        function loginUser() {
            var form = document.getElementById("logInForm")

            var nim = document.getElementById('nim')
            var password = document.getElementById('password')

            var formData = new FormData()

            if(validate(nim, password)) {
                var xhr = new XMLHttpRequest();
				xhr.open("POST", "process/process_login.php", true);
				xhr.onreadystatechange = function() {
					if (xhr.readyState === 4 && xhr.status === 200) {
                        var users = JSON.parse(xhr.response)
                        // console.log(users);

                        var user = users.find((item) => item[0] == nim.value && item[3] == password.value)
                        if(user) {
                            localStorage.setItem('active', user)
                            location.replace('./dashboard.html')
                        } else {
                            Swal.fire({
                                title: 'Error!',
                                text: 'User does not exist!',
                                icon: 'error',
                                confirmButtonText: 'Ok'
                            })
                            failCounter(true)
                        }
					}
				};
				xhr.send(formData);
            } else {
                console.log('Gagal');
                failCounter(true)
            }
        }

        var form = document.getElementById("logInForm")
        form.addEventListener("submit", function(event) {
            event.preventDefault()
            loginUser()
        })
    </script>
</body>
</html>